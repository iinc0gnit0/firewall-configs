### DDOS Protection Rules

###
Consider backing up and flushing iptables before doing this
Actually read the rules before you apply them and change ports/limits to your liking
###

# /etc/sysct.conf configs
net.ipv4.conf.default.rp_filter=1
net.ipv4.conf.all.rp_filter=1
net.ipv4.tcp_syncookies=1
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv4.conf.all.log_martians = 1

# allow traffic from localhost
sudo iptables -A INPUT -i lo -j ACCEPT

# drop all null packets (NULL attack)
sudo iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP

# drop all fragment packets (Fragmentation Flood)
sudo iptables -A INPUT -f -j DROP

# drop malformed xmas packets
sudo iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP

# drop new packets that don't use the syn flag
sudo iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP

# limit syn packets per IP (connection attacks)
sudo iptables -A INPUT -p tcp --syn -m multiport --dports 2200,443,22,23 -m limit --limit 10/second --limit-burst 20 -j ACCEPT

# limit udp packets per IP (udp flood)
sudo iptables -A INPUT -p udp -m multiport --dports 2200,443,22,23 -m limit --limit 15/second --limit-burst 50 -j ACCEPT

# limit icmp echo-request per IP (ping flood)
sudo iptables -I INPUT 7 -p icmp --icmp-type 8 -m limit --limit 1/second --limit-burst 3 -j ACCEPT

# allow traffic on these ports (my public services)
sudo iptables -A INPUT -p tcp --dport 2200 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 23 -j ACCEPT

# allow related and established connections
sudo iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

# drop packets by default
sudo iptables -P INPUT DROP

# Credits
# I took a lot of these rules from these articles and tweaked some of them
https://www.webhostingtalk.com/showthread.php?t=1366995
https://www.cyberciti.biz/tips/linux-iptables-10-how-to-block-common-attack.html
https://gist.github.com/mattia-beta/bd5b1c68e3d51db933181d8a3dc0ba64
